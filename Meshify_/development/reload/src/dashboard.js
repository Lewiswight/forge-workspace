// Generated by CoffeeScript 1.6.2
(function() {
  define(['jquery', 'jqm', 'backbone', 'underscore', 'marionette', 'Meshable', 'Events'], function($, jqm, Backbone, _, Marionette, Meshable, Events) {
    var changePage, dashboard, dashboardView, dashboards, dashboardsView, make_collection;

    make_collection = function() {
      return window.forge.ajax({
        url: Meshable.rooturl + "/api/dashboard",
        dataType: "json",
        type: "GET",
        error: function(e) {
          return alert(e.content);
        },
        success: function(data) {
          var cModel, model, nodeCollection, _i, _len;

          nodeCollection = new dashboards;
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            model = data[_i];
            cModel = new dashboard;
            nodeCollection.add(cModel.parse(model));
          }
          return nodeCollection;
        }
      });
      /*models = JSON.parse """[{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"}]"""
      		
      		nodeCollection = new dashboards
      	 	
      		for model in models
      			cModel = new dashboard
      			nodeCollection.add cModel.parse(model)
      		
      		return nodeCollection
      */

    };
    dashboard = Backbone.Model.extend({
      initialize: function() {
        return this.set({
          trafficlight: Meshable.chooseLight(this.get('trafficlight'))
        });
      },
      defaults: {
        channelname: "Energy Costs",
        status: "",
        address: "123 Main St.",
        value: "1100.50",
        pre: "$",
        post: "",
        trafficlight: "green"
      }
    });
    dashboards = Backbone.Collection.extend({
      model: dashboard
    });
    dashboardView = Backbone.Marionette.ItemView.extend({
      initialize: function(dashboard) {
        return this.bindTo(this.model, "change", this.render);
      },
      template: '#dashboarditem-template',
      tagName: 'li',
      className: "list_item"
    });
    dashboardsView = Backbone.Marionette.CompositeView.extend({
      itemView: dashboardView,
      template: "#wrapper_dashboard",
      itemViewContainer: "ul",
      id: "dashboard",
      appendHtml: function(collectionView, itemView) {
        return collectionView.$("#dashboard_insert").append(itemView.el);
      }
    });
    Meshable.vent.on("goto:dashboard", function() {
      return window.forge.ajax({
        url: Meshable.rooturl + "/api/dashboard",
        dataType: "json",
        type: "GET",
        error: function(e) {
          return alert(e.content);
        },
        success: function(data) {
          var cModel, dashView, model, nodeCollection, _i, _len;

          nodeCollection = new dashboards;
          for (_i = 0, _len = data.length; _i < _len; _i++) {
            model = data[_i];
            cModel = new dashboard;
            nodeCollection.add(cModel.parse(model));
          }
          dashView = new dashboardsView({
            collection: nodeCollection
          });
          /*models = JSON.parse """[{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"},{"address":"123 Main Ave","channelname":"energy cost","post":"","pre":"$","status":"The status","trafficlight":"green","value":"1232"}]"""
          				
          				dashCol = new dashboards
          			 	
          				for model in models
          					cModel = new dashboard
          					dashCol.add cModel.parse(model)
          				
          				dashView = new dashboardsView
          							collection: dashCol
          */

          Meshable.currentpage = "dashboard";
          $.mobile.changePage($('#splash'), {
            changeHash: false,
            transition: 'none',
            showLoadMsg: false
          });
          Meshable.loginRegion.close();
          Meshable.mainRegion.close();
          Meshable.mainRegion.show(dashView);
          $("#dashboard").attr("data-role", "listview");
          $("#dashboard").attr("data-insert", "true");
          return changePage(dashView, false);
        }
      });
    });
    return changePage = function(page, direction) {
      var trans;

      $(page.el).attr("data-role", "page");
      trans = "slide";
      if (this.firstPage) {
        trans = "none";
        this.firstPage = false;
      }
      return $.mobile.changePage($(page.el), {
        changeHash: true,
        reverse: direction,
        transition: "none"
      });
    };
  });

}).call(this);
