// Generated by CoffeeScript 1.6.2
(function() {
  define(['jquery', 'jqm', 'backbone', 'marionette'], function($, jqm, Backbone, Marionette) {
    var Meshable, search;

    Meshable = new Backbone.Marionette.Application();
    Meshable.company = new Object;
    Meshable.user = new Object;
    Meshable.location = new Object;
    Meshable.theme = "a";
    Meshable.rooturl = "http://ctan.meshify.co";
    Meshable.current - (search = null);
    Meshable.current_units = "";
    Meshable.current_gateways = "";
    Meshable.currentDataObj = "";
    Meshable.current_searchTerm = "";
    Meshable.current_index_gw = 0;
    Meshable.current_index = 0;
    Meshable.nodeCoView = "";
    Meshable.backplace = "";
    Meshable.nodeCollection = "";
    Meshable.refreshUnits = false;
    Meshable.currentMap = null;
    Meshable.mapRefresh = false;
    Meshable.loading = false;
    Meshable.addRegions({
      loginRegion: "#login",
      mainRegion: "#mainR",
      searchRegion: "#searchR",
      menuRegion: "#menuR"
    });
    $(document).on("click", "#newPas", function() {
      return Meshable.vent.trigger("new:password");
    });
    Meshable.changePage = function(page, direction) {
      $(page.el).attr("data-role", "page");
      $(page.el).attr("data-theme", Meshable.theme);
      $.mobile.changePage($(page.el), {
        changeHash: true,
        reverse: direction,
        transition: "fade"
      });
      return $("#locationbtnn").addClass('ui-btn-active');
    };
    Meshable.on("initialize:after", function(options) {
      $.mobile.autoInitializePage = false;
      $.mobile.pageContainer = $("body");
      $.mobile.ajaxEnabled = false;
      $.mobile.linkBindingEnabled = false;
      $.mobile.hashListeningEnabled = false;
      $.mobile.pushStateEnabled = true;
      $.mobile.loader.prototype.options.text = "loading";
      $.mobile.loader.prototype.options.textVisible = true;
      $.mobile.loader.prototype.options.theme = "c";
      return Backbone.history.start({
        root: window.location.protocol + "//" + window.location.host,
        pushState: false
      });
    });
    forge.topbar.setTitle("Meshify");
    forge.topbar.addButton({
      text: "Refresh",
      position: "right"
    }, function() {
      return Meshable.vent.trigger("goto:refresh");
    });
    Meshable.vent.on("goto:refresh", function() {
      var route;

      route = Backbone.history.fragment;
      if (route === "units") {
        if (Meshable.current_index > 0) {
          Meshable.currentDataObj = "";
        }
        Meshable.current_units = "";
      } else if (route === "gateways") {
        Meshable.mapRefresh = true;
      } else if (route.substring(0, 10) === "searching/") {
        Meshable.mapRefresh = true;
      }
      Meshable.router.navigate("nowhere", {
        trigger: false,
        replace: true
      });
      return Meshable.router.navigate(route, {
        trigger: true,
        replace: true
      });
    });
    forge.topbar.addButton({
      text: "Back",
      position: "left"
    }, function() {
      $("body").addClass('ui-disabled');
      $.mobile.showPageLoadingMsg("a", "Loading", false);
      return window.history.back();
    });
    forge.tabbar.addButton({
      text: "Map",
      icon: "img/compass.png",
      index: 0
    }, function(button) {
      Meshable.locationButton = button;
      return button.onPressed.addListener(function() {
        if (Meshable.loading === false) {
          return Meshable.router.navigate("gateways", {
            trigger: true
          });
        }
      });
    });
    forge.tabbar.addButton({
      text: "Units",
      icon: "img/text-list.png",
      index: 1
    }, function(button) {
      Meshable.unitsButton = button;
      button.onPressed.addListener(function() {
        if (Meshable.loading === false) {
          return Meshable.router.navigate("units", {
            trigger: true
          });
        }
      });
      return button.setActive();
    });
    forge.tabbar.addButton({
      text: "Search",
      icon: "img/search.png",
      index: 2
    }, function(button) {
      Meshable.searchButton = button;
      return button.onPressed.addListener(function() {
        if (Meshable.loading === false) {
          return Meshable.router.navigate("search", {
            trigger: true
          });
        }
      });
    });
    forge.tabbar.addButton({
      text: "Contact",
      icon: "img/phone.png",
      index: 3
    }, function(button) {
      Meshable.contactButton = button;
      return button.onPressed.addListener(function() {
        if (Meshable.loading === false) {
          return Meshable.router.navigate("contact", {
            trigger: true
          });
        }
      });
    });
    forge.tabbar.addButton({
      text: "Log Out",
      icon: "img/power-button.png",
      index: 4
    }, function(button) {
      return button.onPressed.addListener(function() {
        return Meshable.router.navigate("logout", {
          trigger: true
        });
      });
    });
    return Meshable;
  });

}).call(this);
